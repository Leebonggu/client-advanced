# 프론트엔드 프로젝트에서 클래스가 필요한 경우는 언제일까

사실 개발 블로그에 쓰고 싶었는데, 이런 고민이 과연 일반적일까? 나만 이런걸 고민했던건 아닐까..? 하는 의문이 들어서 여기다가 먼저 써 본다. 

## 왜 생각해 보았나

프론트엔드 프로젝트에 클래스를 쓰고 싶은 상황이 있었는데, 일단 그냥 막연하게만 써볼까~~~ 정도로 생각하고 있었던 것 같다. 좋은 개발자님의 조언도 듣고, 여러 검증을 해본 결과 아래와 같은 이유 때문에 좋지 못하다는 결론을 냈다.

- **트리 쉐이킹에 불리함** : [직접 babel, TypeScript 설정하고 트리쉐이킹이 되는지 실험해 봤는데]('../21_bundler-tree-shaking/README.md) Class는 TreeShaking이 되지 않았다. 안 쓰는 메소드도 다 번들에 포함되었다. 기본적으로는 [정적 분석이 어렵기 때문에 클래스, 클래스의 Static 메소드는 트리쉐이킹이 잘 안 된다.](https://blog.logrocket.com/tree-shaking-and-code-splitting-in-webpack/) [이 글](https://medium.com/naver-fe-platform/webpack%EC%97%90%EC%84%9C-tree-shaking-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0-1748e0e0c365)에 따르면 Babel 7부터는 Class에 Pure Annotation을 붙여 트리쉐이킹을 돕는다고 해서 좀 기대해 봤는데 일단 내 실험에서는 트리쉐이킹이 되는 모습을 확인할 수 없었다. 번들의 크기를 줄이는게 중요한 클라이언트 프로덕트에 치명적인 단점이다.
- **클래스의 취지를 잘 살리지 못하는 클래스는 사실 의미없음** : 클래스는 어떤 객체의 "동작"과 "상태"를 모두 가지면서 해당 객체를 효과적으로 모델링하기 위해 존재하는 개념이다. 
  - 근데 내가 주로 클래스를 활용하고 싶었던 이유는 프로젝트에서 서버로부터 받아온 데이터를 적당히 가공하여 View에 필요한 방식으로 만드는 Helper 함수들을 Public, Private 등의 접근 제어자로 관리해 Helper 함수들과의 관계를 더 잘 표현하고, 기능적 관심사가 같은 함수들을 클래스에 묶어놓으면 관리가 편할 것이라는 이유가 컸다. 
  - 그래서 사실 서버에서 받아온 하나의 데이터 외에는 메서드에서 공통적으로 필요한 멤버변수를 설정하기가 매우 어려웠고, 2개 이상의 멤버변수도 사실 필요가 없었다. 
  - 사실 아래와 같은 클래스는 별로 의미가 없다. 함수로 분리하고 가져다 써도 별로 큰 차이가 없다. 그런데 내가 만들고자 하는 클래스가 이런거에 가깝다는 생각이 들었다.
  ```js
  // 동작만 존재하는 클래스
  class UserInfoHelper() {

    constructor() {}
    
    someMethod1() {
      ...
    }

    someMethod2() {
      ...
    }

    static someMethod2() {
      ...
    }
  }
  ```
  - 사실 helper 함수들은 순수 함수처럼 만들 수 있기 때문에 클래스의 속성과 엮일 일이 없게끔 만들 수 있다.
- **Private 메서드도 테스트하고 싶은 상황이 생기지 않을까?** : 물론 제어 흐름상 public한 메서드에서 private한 메서드가 호출될 것이므로 public 메서드를 테스팅하면 얼추 private 메서드까지 테스팅할 수 있겠지만, private을 테스트하는게 테스트 케이스를 더 효과적으로 작성할 수 있는 방법이 되는 상황도 있을 수 있다. 굳이 제약을 걸어서 테스트의 가능성을 좁히는 일이 과연 타당할까?
- **모든 함수가 호출 가능해야만 하는 상황이 있을까?** : 클래스 인스턴스를 만들면 인스턴스 내부의 모든 함수들을 호출 가능하게 만들 수 있다. 그런데 프론트엔드 프로젝트에서 Helper 함수들은 굳이 모든 함수들이 인스턴스가 있는 모든 상황에서 호출될 필요가 없다. 모든 Helper 함수들은 저마다의 용례를 가지고 있기 때문에 만들어진 친구들이다. 당연히 필요한 상황과 장소에서만 쓰이기 때문에 Named export로 적제적소에 코딩을 해주는게 낫지 굳이 많은 함수들이 인스턴스 안에 들어가 호출을 기다릴 필요가 없다. 오버킬이다.

## 클래스가 필요할 수 있는 경우

### 1. 메소드 체이닝을 활용하면서 개발자에게 자율권을 주는 라이브러리를 만드는 경우

- 어떤 라이브러리가 여러 메소드를 자유롭게 이용할 수 있는 자율권을 부여하여 개발자의 목적을 달성하게 만드는 라이브러리라면, 그런 측면에서는 클래스가 의미가 있을 수 있다.
- 특히 클래스로 객체를 만들면 **메서드 체이닝**을 사용할 수 있고, 체이닝으로 연달아 호출하는 로직을 선택하는 것을 라이브러리 사용자의 몫으로 만들고 싶다면 클래스를 사용하는 것이 적합할 수도 있다.
- 다만 꼭 클래스를 통해서만 자율권을 부여할 수 있는 것은 아니다. RxJS의 접근 방식이 그걸 보여준다.

```js
// obs.pipe(op1(), op2(), op3(), op4());
import { first, last, map, reduce, find, skipWhile } from 'rxjs/operators';
observable.pipe(
    map(x => {return x}),
    first()
  ).subscribe(x => {})
```
- RxJS의 Observable은 메서드 채이닝으로 pipe와 subscribe메소드를 연달아 호출할 수 있지만, pipe는 여러 연산자를 인자로 받아 함수형으로 데이터를 처리한다. pipe 메소드는 연산자를 인자로 받는 형식으로 사용자에게 자율권을 준다.
- 모든 메소드를 observable 클래스 안에 구현하지 않는 방법을 택함으로써 연산의 확장 가능성을 담보한 것이다.

### 2. 복잡한 속성과 동작을 객체로 모델링해야할 필요가 생기는 경우

- 이건 진짜 클래스의 취지를 제대로 살릴 수 있는 경우다.
- 완전 새로운 타입이 필요한 경우라고도 할 수 있겠다.
- 인터랙티브 웹 개발을 예로 들 수 있겠는데. 해커톤에 참여했을 때 웹 게임을 만든 적이 있는데 게임에 등장하는 개체들을 클래스로 정의한 것이 복잡한 로직을 정리하여 효과적으로 개발하는데 도움이 많이 되었다.

### 3. 클래스를 프레임워크의 인터페이스로 활용하는 경우

- 프레임워크 개발에 클래스를 사용하면 implment, 상속 등으로 기능을 여러 레벨로 추상화할 수 있어 탄탄한 설계를 가진 프레임워크가 될 수 있다.
- 프레임워크 사용하는 개발자에게 클래스를 작성하는 방식으로 앱을 만들 수 있게 하는 프레임워크라면, 작성을 해야만 하는 약속된 메서드, 데코레이터 등의 기능을 이용하여 프레임워크 사용자들에게 상당히 많은 정보와 신뢰성을 제공할 수 있다.
  - 당장 React Class 컴포넌트를 생각해봐도 constructor에 state와 prop을 정의하는 방식, render() 메소드, 생명주기 등 많은 부분들이 문법적으로 미리 정해져있고 사용자가 이를 따르게끔 할 수 있었다.
  - 그에비해 함수형은 Hooks는 그냥 함수라서 사실 자유롭게 호출할 수 있다. 하지만 side-effect를 발생할 여지가 높기 때문에 hook rule 등을 적용해 에러를 발생시키고 있지만, **문법이 틀린 것은 아니다**
- 개발자는 작성만 하고 인스턴스의 생성과 실행을 프레임워크가 담당하고 위임하는 방식이라면 개발자는 만든 클래스를 어떻게 설계하고 사용할지 골머리를 앓지 않아도 된다.
- Angular나 Nest.js가 이런 클래스 기반의 인터페이스를 제공하는 프레임워크에 해당된다.

# 결론

클래스는 적시에 사용하면 유용한 도구가 될 수 있다. 그런데 내가 쓰고자 하는 방법은 그렇지 않았다. 